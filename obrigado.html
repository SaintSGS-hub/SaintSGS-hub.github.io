<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pagamento Confirmado!</title>
<link rel="icon" type="image/png" href="img/favicon.png">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background:
    radial-gradient(circle at top, rgba(255, 200, 0, 0.04), transparent 60%),
    #000;
}
#parallax-wrapper {
  perspective: 1200px;
  transform-style: preserve-3d;
}
.card-depth {
  transition: transform 0.2s ease-out;
  will-change: transform;
}
</style>
</head>

<body class="bg-black text-white font-sans">

<div id="parallax-wrapper">
<div class="max-w-xl mx-auto p-6">

<h1 class="text-3xl mb-4 font-bold text-center glow-float">Pagamento recebido!</h1>

<p class="text-center text-gray-400 mb-6">
Preencha os dados para entrega
</p>

<form action="https://formsubmit.co/saintwwmofficial@gmail.com" method="POST" class="space-y-4 card-depth">

  <input type="hidden" name="_subject" value="Novo Pedido Echo Beads">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_next" value="https://saintsgs-hub.github.io/confirmado.html">
  <input type="hidden" name="_honeypot" value="">

  <!-- CAMPOS OCULTOS -->
  <input type="hidden" name="ip">
  <input type="hidden" name="pais">
  <input type="hidden" name="cidade">
  <input type="hidden" name="horario">
  <input type="hidden" name="produto">
  <input type="hidden" name="txid">

  <!-- CAMPOS VISÍVEIS -->
  <input class="w-full p-2 rounded bg-zinc-800"
         name="nick"
         placeholder="Nome no jogo"
         required>

  <input class="w-full p-2 rounded bg-zinc-800"
         name="id"
         placeholder="ID da conta (somente números)"
         required
         inputmode="numeric"
         pattern="[0-9]+"
         oninput="this.value = this.value.replace(/[^0-9]/g, '')">

  <input class="w-full p-2 rounded bg-zinc-800"
         name="telefone"
         placeholder="WhatsApp (Ex: +55 11 99999-9999)"
         required
         inputmode="tel"
         pattern="[0-9+\-\s]+"
         oninput="this.value = this.value.replace(/[^0-9+\-\s]/g, '')">

  <input class="w-full p-2 rounded bg-zinc-800"
         type="email"
         name="email_cliente"
         placeholder="Seu e-mail"
         required>

  <button type="submit" class="w-full bg-yellow-500 text-black py-2 rounded-lg">
    Confirmar Entrega
  </button>

</form>

<!-- PAINEL ATENÇÃO -->
<div class="mt-10 bg-zinc-900 border border-yellow-500 text-yellow-400 p-4 rounded text-sm text-center card-depth">
<strong>Atenção:</strong><br>
Pedidos enviados sem pagamento confirmado serão automaticamente ignorados.<br>
A entrega só é realizada após a verificação do pagamento pelo Mercado Pago.
</div>

<!-- PAINEL DE INSTRUÇÃO -->
<div class="mt-6 bg-zinc-900 border border-zinc-700 p-4 rounded text-sm text-center card-depth">
  <strong class="text-white block mb-2 font-bold text-center glow-float">
    Onde encontrar seu Nome e ID no jogo?!
  </strong>
  <p class="text-gray-400 mb-3">
    Utilize a imagem abaixo como referência para procurar no jogo e preencher corretamente os campos.
  </p>
  <img src="img/perfilID.png"
       alt="Exemplo de onde encontrar o Nome e ID no jogo"
       class="mx-auto rounded border border-zinc-700 max-w-full">
</div>

</div>
</div>

<script src="js/effects.js"></script>

<script>
/* ================================
   GEOLOCALIZAÇÃO
================================ */
let geo = { ip: "N/A", country: "N/A", city: "N/A" };

fetch("https://ipinfo.io/json")
  .then(r => r.json())
  .then(d => {
    geo.ip = d.ip || "N/A";
    geo.country = d.country || "N/A";
    geo.city = d.city || "N/A";
  });

/* ================================
   PRODUTO VIA LOCALSTORAGE
================================ */
const produtoLS = localStorage.getItem("produto") || "Produto não identificado";

/* ================================
   TXID DO MERCADO PAGO
================================ */
const params = new URLSearchParams(window.location.search);
const txidAuto =
  params.get("payment_id") ||
  params.get("collection_id") ||
  params.get("id") ||
  "N/A";

/* ================================
   SUBMIT
================================ */
document.querySelector("form").addEventListener("submit", function () {

  const form = this;

  const now = new Date();
  const dia = now.toLocaleDateString("pt-BR");
  const horario = now.toLocaleTimeString("pt-BR");

  form.ip.value = geo.ip;
  form.pais.value = geo.country;
  form.cidade.value = geo.city;
  form.horario.value = `${dia} ${horario}`;
  form.produto.value = produtoLS;
  form.txid.value = txidAuto;

  fetch("https://saint-echo-backend.neuroniosgames.workers.dev/submit-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      produto: produtoLS,
      nick: form.nick.value,
      jogador_id: form.id.value,
      whatsapp: form.telefone.value,
      email_cliente: form.email_cliente.value,
      ip: geo.ip,
      pais: geo.country,
      cidade: geo.city,
      data: dia,
      horario: horario,
      txid: txidAuto
    })
  });

});
</script>

</body>
</html>
