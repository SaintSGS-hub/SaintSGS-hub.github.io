<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<!-- EDITAR NOME AQUI -->
<title>Payment ‚Ä¢ 60 Echo Beads</title>
<link rel="icon" type="image/png" href="/img/favicon.png">
<script src="https://cdn.tailwindcss.com"></script>

<!-- Mercado Pago SDK -->
<script src="https://sdk.mercadopago.com/js/v2"></script>

<style>
body {
  background: #000; /* fundo preto s√≥lido */
  font-family: sans-serif;
}
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background:
   radial-gradient(circle at top, rgba(255,200,0,0.04), transparent 80%),
   url('/img/fundo.png') center center / cover no-repeat;
  opacity: 0.25;
  z-index: -1;
  pointer-events: none;
}
.glass-card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  border: 1px solid rgba(255,255,255,255,0.2);
  box-shadow: 0 8px 32px rgba(0,0,0,0.25);
  padding: 24px;
  color: white;
}
.glow-float {
  animation: floatGlow 3s ease-in-out infinite;
  text-shadow: 0 0 6px rgba(255,255,255,0.3);
}
.valor-glow {
  font-size: 1.6rem;
  font-weight: bold;
  color: #FFD700;
  text-shadow: 0 0 8px #FFD700;
  }
.valor-glow2 {
  font-size: 0.9rem;
  font-weight: bold;
  color: #FFD700;
  text-shadow: 0 0 8px #FFD700;
}
@keyframes floatGlow {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-3px); }
  100% { transform: translateY(0px); }
}
.btn-comprar {
  background: #FFD700;
  color: #000;
  font-weight: bold;
  padding: 14px;
  border-radius: 14px;
  width: 100%;
  margin-top: 12px;
}
/* Home discreto */
.home-link {
  position: fixed;
  top: 16px;
  left: 16px;
  font-size: 14px;
  color: rgba(255,255,255,0.5);
  text-decoration: none;
  transition: color 0.2s;
  z-index: 50;
}
.home-link:hover {
  color: #fff;
}

.price-wrapper {
  position: relative;
  display: inline-block;
}

.price-slash {
  position: absolute;
  top: -19px;
  right: 43px;
  width: 90px;
  pointer-events: none;
  }
  
</style>
</head>

<body>

<a href="/en/en-index.html" class="home-link">‚Üê Home</a>

<div class="min-h-screen flex items-center justify-center p-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl w-full">

    <div class="glass-card text-center glow-float">
      <h1 class="text-2xl font-bold mb-2">ü¶™ 60 Echo Beads ü¶™</h1>
<!-- EDITAR QUANTIDADE AQUI -->
     <p class="text-gray-300 text-center mb-4">
       This package adds <strong>60 Echo Beads</strong> directly into your game account Where Winds Meet.
     </p>
<!-- EDITAR VALOR E IMAGEM AQUI -->
      <img src="/img/echo60.png" class="mx-auto w-32 mb-4">
      <div class="price-wrapper">
  <span class="glow-float text-center font-bold text-red-500">US$‚ÄØ9.00</span><br>
    <img
      src="/img/knightwwm.gif"
      alt="10% OFF"
      class="price-slash"
    />
      <!-- EDITAR VALOR AQUI -->
      <span class="valor-glow glow-float text-xl mb-2 font-extrabold text-center">US$‚ÄØ4.00</span><br>
</div>

<p class="valor-glow glow-float text-xl mb-2 font-bold text-center">
  10% OFF WHEN YOU BUY WITHIN <span id="timer">07:00:00</span>
</p><br>

<span class="valor-glow">_______________________________ </span>
      
      <!-- EDITAR DESCRICAO AQUI -->
<p class="text-xs text-gray-200 font-semibold mt-4">
        When you buy, you get:<br>
        ‚Ä¢ 60 Echo Beads<br>
        Echo Beads can be used in the in-game store to:<br>
        ‚Ä¢ Unlock premium skins, mounts, weapons, visual effects, and other cosmetic items.<br>
        ‚Ä¢ Participate in draws for a chance to win rare cosmetic items.<br>
      </p>
<p class="text-xs text-gray-500 mt-4">
        Information obtained from official materials for the game Where Winds Meet, developed by Everstone Studio and published by NetEase Games, the official creator and distributor of Echo Beads. All rights reserved.<br>
      </p>
      
     <span class="valor-glow">_______________________________ </span>
      
    <p class="text-xs text-gray-400 font-semibold mt-4">
        ‚Ä¢ Manual delivery after confirmation from Mercado Pago<br>
        ‚Ä¢ 100% secure payment<br>
        ‚Ä¢ Products paid for by bank slip will not be delivered and may not be refunded.<br>
      </p>

     <span class="valor-glow">_______________________________ </span>
      
    <p class="text-xs text-gray-300 mt-10">
        This package is exclusive to the PC/Computer/Launcher/Steam/EpicGames version.<br>
      Echo Beads purchased here will not appear on PlayStation 5, Android, or iOS due to platform restrictions.
      </p>

      <span class="valor-glow">_______________________________ </span><br>
      <!-- EDITAR FOTO AQUI -->
      <img src="/img/echo1.png" class="mx-auto w-45 mb-10"><br>
          
      <span class="valor-glow">_______________________________ </span>
    </div>

   <div class="glass-card glow-float flex flex-col text-center justify-center">

   <p class="text-xs text-gray-200 font-semibold mt-4">
        ‚Ä¢ For greater customer discounts, ALL products in $USD / ‚Ç¨EUR / ‚ÇΩRUB will be processed in R$BRL.<br>

        ‚Ä¢ For payments in $USD / ‚Ç¨EUR / ‚ÇΩRUB, please use the credit card option.<br>
      </p>

     <h2 class="text-xl font-bold mb-6">Select Method</h2>

   <div id="paymentBrick_container"></div>

    <p class="text-xs font-bold text-gray-400 text-center">
      ‚Ä¢ PIX ‚Ä¢ Card ‚Ä¢ MP balance ‚Ä¢ And much more
      </p>
    </div>

  </div>
</div>

<!-- DISCORD -->
<a href="https://discordapp.com/users/715081298254888990" target="_blank" id="discord-icon">
  <img src="/img/discord.png" alt="Discord" />
</a>

<style>
#discord-icon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  z-index: 1000;
}
#discord-icon:hover {
  transform: scale(1.1);
}
</style>

<!-- BOT√ÉO SUPORTE -->
<div id="support-btn">
  <img src="/img/suporte.png" alt="Suporte" />
</div>

<style>
#support-btn {
  position: fixed;
  bottom: 90px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #FFD700;
  color: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,.4);
  z-index: 1000;
}
#support-btn:hover {
  transform: scale(1.08);
}
</style>

<div id="support-modal">
  <form id="support-form">
    <h2>Contato com Suporte</h2>

    <input name="name" placeholder="Nome completo" required>
    <input name="whatsapp" placeholder="WhatsApp" required>
    <input name="email" type="email" placeholder="Email" required>
    <input name="subject" placeholder="Assunto" required>
    <textarea name="message" placeholder="Mensagem" required></textarea>

    <button type="submit">Enviar</button>
  </form>
</div>

<style>
#support-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  z-index: 1001;
}
#support-form {
  background: #111;
  color: #fff;
  max-width: 400px;
  margin: 10% auto;
  padding: 20px;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
#support-form input,
#support-form textarea {
  padding: 10px;
  border-radius: 8px;
  border: none;

  background: #fff;   /* fundo do campo */
  color: #111;        /* texto que o cliente digita */
}
</style>

<script src="/js/effects.js"></script>

<script>
const btn = document.getElementById("support-btn");
const modal = document.getElementById("support-modal");

btn.onclick = () => modal.style.display = "block";
modal.onclick = e => {
  if (e.target === modal) modal.style.display = "none";
};
</script>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init("fjXHE6FnezGdisp_s");
})();

document.getElementById("support-form").addEventListener("submit", function(e){
  e.preventDefault();

  emailjs.sendForm(
    "service_cuecopv",
    "template_m4anla3",
    this
  ).then(() => {
    alert("Mensagem enviada com sucesso!");
    this.reset();
    document.getElementById("support-modal").style.display = "none";
  }, err => {
    alert("Erro ao enviar mensagem");
    console.error(err);
  });
});
</script>

<footer class="w-full mt-16 pt-8 pb-6">
  <div class="max-w-5xl mx-auto text-center text-sm text-gray-300 space-y-4">

    <!-- Linha 2: M√©todos de pagamento -->
    <div class="flex flex-wrap justify-center items-center gap-4 mt-4">
      <img src="/img/pix.png" alt="Pix" class="h-6">
      <img src="/img/visa.png" alt="Visa" class="h-6">
      <img src="/img/mastercard.png" alt="MasterCard" class="h-6">
      <img src="/img/mercadopago.png" alt="Mercado Pago" class="h-6">
    </div>
    
    <!-- Linha 1: Seguran√ßa b√°sica -->
    <div class="flex flex-wrap justify-center font-semibold gap-6">
      <span>üîí Secure payment</span>
      <span>üßæ Secure purchase</span>
      <span>‚ö° Automatic digital delivery / Manual verification</span>
    </div>

    <!-- Linha 3: Selos textuais (subconsciente trabalha aqui) -->
    <div class="flex flex-wrap justify-center gap-6 mt-4 text-xs font-semibold uppercase tracking-wide">
      <span>üîê SSL Secure Checkout</span>
      <span>üßæ Terms Accepted</span>
      <span>‚öôÔ∏è Manual delivery after confirmation</span>
      <span>‚è±Ô∏è 24-hour service ON</span>
    </div>

    <!-- Linha 4: Claims de confian√ßa (estilo marketplaces grandes) -->
    <div class="valor-glow2 flex flex-wrap justify-center gap-6 mt-4 font-semibold">
      <span>‚úî Secure Digital Delivery</span>
      <span>‚úî Verified Payment Flow</span>
      <span>‚úî Manual In-Game Delivery</span>
      <span>‚úî Terms Accepted & Logged</span>
    </div>

    <!-- Linha 5: Legal -->
    <div class="mt-6 text-xs text-gray-400">
      <a href="/en/en-tos.html" class="underline">Terms of Use</a> ‚Ä¢
      <a href="/en/en-privacidade.html" class="underline">Privacy Policy</a>
    </div>

  </div>
</footer>

<script>
// checkout-mercadopago2.js
// - Auto-open do Bricks (modal/iframe) dentro do seu site (sem redirect para init_point)
// - Tema dark, fallback para abrir por gesto do usu√°rio se navegador bloquear auto-open
// - Ao concluir pagamento aprovado, redireciona para /obrigado.html?collection_id=<id>
// - Usa endpoints do seu worker: /create-payment-bricks e /process-payment
//
// Incluir no HTML: <div id="paymentBrick_container"></div>
// Opcional: um bot√£o ser√° criado automaticamente caso o navegador bloqueie abertura autom√°tica.

(function () {
  const workerUrl = "https://saint-echo-backend.neuroniosgames.workers.dev"; // ajuste se necess√°rio
  const MP_PUBLIC_KEY = "APP_USR-ecd9f6e7-02f7-4bb3-b757-10a0453ab646";
  const produtoDefault = localStorage.getItem("produto") || "60 Echo Beads";
  localStorage.setItem("produto", produtoDefault);
  const valorDefault = Number(11.45);

  if (typeof MercadoPago === "undefined") {
    console.error("MercadoPago SDK n√£o carregado. Adicione script src='https://sdk.mercadopago.com/js/v2'>script");
    return;
  }

  const mp = new MercadoPago(MP_PUBLIC_KEY, { locale: "pt-BR" });

  async function createPreferenceIfNeeded(produto, valor, consentId) {
    try {
      const saved = JSON.parse(localStorage.getItem("saint_pref") || "null");
      if (saved && saved.preference_id) {
        return saved;
      }
    } catch (e) {}

    const res = await fetch(`${workerUrl}/create-payment-bricks`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ produto, valor, consent_id: consentId }),
    });

    const data = await res.json().catch(() => null);
    if (!data || !data.preference_id) {
      throw new Error("Erro ao criar preference: " + JSON.stringify(data));
    }

    try {
      localStorage.setItem("saint_pref", JSON.stringify({
        preference_id: data.preference_id,
        produto,
        created_at: Date.now()
      }));
    } catch (e) {}

    return { preference_id: data.preference_id };
  }

  function ensureContainer() {
    let el = document.getElementById("paymentBrick_container");
    if (!el) {
      el = document.createElement("div");
      el.id = "paymentBrick_container";
      document.body.appendChild(el);
    }
    return el;
  }

  async function openBricks(preferenceId, amount, consentId) {
    const container = ensureContainer();
    container.innerHTML = "";

    const bricksBuilder = mp.bricks();

    try {
      bricksBuilder.create("payment", "paymentBrick_container", {
        initialization: { preferenceId, amount },
        customization: {
          visual: { style: { theme: "dark" } },
          paymentMethods: { bankTransfer: "all", creditCard: "all", debitCard: "all", mercadoPago: "all" },
        },
        callbacks: {
          onReady: () => console.log("üü¢ Payment Brick pronto"),
          onError: (err) => console.error("üî¥ Erro no Payment Brick", err),
          onSubmit: ({ formData }) => {
            return new Promise((resolve, reject) => {
              fetch(`${workerUrl}/process-payment`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ...formData, consent_id: consentId }),
              })
                .then((r) => r.json())
                .then((paymentData) => {
                  const paymentId = paymentData.id || paymentData.payment_id || (paymentData.payment && paymentData.payment.id);
                  const status = paymentData.status;

                  if (paymentId && status === "approved") {
                    console.log("Pagamento aprovado, id:", paymentId);
                    const targetUrl = `/obrigado.html?collection_id=${encodeURIComponent(paymentId)}`;
                    window.location.href = targetUrl;
                    resolve();
                  } else {
                    console.warn("Pagamento n√£o aprovado ainda:", paymentData);
                    reject();
                  }
                })
                .catch((err) => {
                  console.error("Erro no process-payment:", err);
                  reject();
                });
            });
          },
        },
      });
    } catch (err) {
      console.error("Cria√ß√£o do Brick falhou:", err);
      throw err;
    }
  }

  function createOpenButton(container, onClick) {
    let btn = document.getElementById("mp-open-btn");
    if (!btn) {
      btn = document.createElement("button");
      btn.id = "mp-open-btn";
      btn.textContent = "Abrir checkout";
      btn.className = "btn-comprar";
      btn.style.display = "block";
      btn.style.margin = "16px auto";
      btn.style.maxWidth = "320px";
      btn.style.cursor = "pointer";
      container.appendChild(btn);
    }
    btn.onclick = onClick;
    return btn;
  }

  async function startCheckoutAuto(openButtonFallback = true) {
    const consent = JSON.parse(localStorage.getItem("saint_consent") || "null");
    if (!consent?.consent_id) {
      console.warn("Consentimento n√£o encontrado ‚Äî n√£o iniciando checkout automaticamente.");
      return;
    }

    try {
      const pref = await createPreferenceIfNeeded(produtoDefault, valorDefault, consent.consent_id);
      await openBricks(pref.preference_id, valorDefault, consent.consent_id);
    } catch (err) {
      console.error("Erro ao abrir Bricks automaticamente:", err);
      if (openButtonFallback) {
        const container = ensureContainer();
        const btn = createOpenButton(container, async () => {
          try {
            btn.disabled = true;
            btn.textContent = "Aguarde...";
            const pref = await createPreferenceIfNeeded(produtoDefault, valorDefault, JSON.parse(localStorage.getItem("saint_consent")).consent_id);
            await openBricks(pref.preference_id, valorDefault, JSON.parse(localStorage.getItem("saint_consent")).consent_id);
          } catch (e) {
            console.error("Erro no fallback openBricks:", e);
            alert("N√£o foi poss√≠vel abrir o checkout automaticamente. Tente novamente.");
            btn.disabled = false;
            btn.textContent = "Abrir checkout";
          }
        });
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    startCheckoutAuto(true).catch(() => {});
  });

  window.__saint_open_bricks = async function () {
    await startCheckoutAuto(false);
  };
})();
</script>

<script>
  const DURATION = 7 * 60 * 60; // 7 horas em segundos
  const STORAGE_KEY = "promoTimerStart";

  function getStartTime() {
    let start = localStorage.getItem(STORAGE_KEY);
    if (!start) {
      start = Date.now();
      localStorage.setItem(STORAGE_KEY, start);
    }
    return parseInt(start, 10);
  }

  function updateTimer() {
    const startTime = getStartTime();
    const now = Date.now();

    let elapsed = Math.floor((now - startTime) / 1000);
    let remaining = DURATION - (elapsed % DURATION);

    if (remaining <= 0) remaining = DURATION;

    const h = String(Math.floor(remaining / 3600)).padStart(2, "0");
    const m = String(Math.floor((remaining % 3600) / 60)).padStart(2, "0");
    const s = String(remaining % 60).padStart(2, "0");

    document.getElementById("timer").textContent = `${h}:${m}:${s}`;
  }

  updateTimer();
  setInterval(updateTimer, 1000);
</script>
  
</body>
</html>
